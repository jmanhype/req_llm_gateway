@prefix sh:   <http://www.w3.org/ns/shacl#> .
@prefix xsd:  <http://www.w3.org/2001/XMLSchema#> .
@prefix rec:  <https://spec.rec-llm-gateway.dev/rec#> .
@prefix rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .

### Request shape (OpenAI-compatible + MVP rules)
rec:RequestShape a sh:NodeShape ;
  sh:targetClass rec:Request ;
  sh:property [
    sh:path rec:modelId ; sh:datatype xsd:string ; sh:minCount 1 ;
    sh:message "model is required (provider:model or bare model)" ;
  ] ;
  sh:property [
    sh:path rec:hasMessage ; sh:minCount 1 ;
    sh:message "messages[] must be non-empty" ;
  ] ;
  sh:property [
    sh:path rec:temperature ; sh:datatype xsd:decimal ;
    sh:minInclusive 0 ; sh:maxInclusive 2 ;
    sh:severity sh:Violation ;
    sh:message "temperature must be 0..2"
  ] ;
  sh:property [
    sh:path rec:topP ; sh:datatype xsd:decimal ;
    sh:minExclusive 0 ; sh:maxInclusive 1 ;
    sh:message "top_p must be (0,1]"
  ] ;
  sh:property [
    sh:path rec:stream ; sh:datatype xsd:boolean ;
    sh:hasValue false ;
    sh:message "MVP: stream must be false"
  ] .

### Message shape
rec:MessageShape a sh:NodeShape ;
  sh:targetClass rec:Message ;
  sh:property [
    sh:path rec:role ; sh:minCount 1 ;
    sh:in ( rec:System rec:User rec:Assistant rec:Tool ) ;
    sh:message "role must be one of system|user|assistant|tool"
  ] ;
  sh:property [
    sh:path rec:content ; sh:datatype xsd:string ; sh:minCount 1 ;
    sh:message "content is required"
  ] .

### Response shape
rec:ResponseShape a sh:NodeShape ;
  sh:targetClass rec:Response ;
  sh:property [
    sh:path rec:choice ; sh:minCount 1 ;
    sh:message "choices[] must contain at least one choice"
  ] ;
  sh:property [
    sh:path rec:usage ; sh:minCount 1 ;
    sh:message "usage is required with token counts"
  ] ;
  sh:property [
    sh:path rec:extension ; sh:minCount 1 ;
    sh:message "x_rec_llm extension required (provider, latency, cost)"
  ] .

### Usage shape
rec:UsageShape a sh:NodeShape ;
  sh:targetClass rec:Usage ;
  sh:property [ sh:path rec:promptTokens ; sh:datatype xsd:integer ; sh:minInclusive 0 ] ;
  sh:property [ sh:path rec:completionTokens ; sh:datatype xsd:integer ; sh:minInclusive 0 ] ;
  sh:property [ sh:path rec:totalTokens ; sh:datatype xsd:integer ; sh:minInclusive 0 ] .

### Extension shape
rec:ExtensionShape a sh:NodeShape ;
  sh:targetClass rec:Extension ;
  sh:property [ sh:path rec:xProvider ; sh:minCount 1 ] ;
  sh:property [ sh:path rec:latencyMs ; sh:datatype xsd:integer ; sh:minInclusive 0 ] ;
  sh:property [ sh:path rec:costUSD ; sh:datatype xsd:decimal ] ;
  sh:property [ sh:path rec:receiptChain ; sh:datatype xsd:string ; sh:minCount 1 ;
                sh:message "receipt_chain is required for auditability" ] .

### Error shape
rec:ErrorShape a sh:NodeShape ;
  sh:targetClass rec:Error ;
  sh:property [ sh:path rec:errorType ; sh:in ( rec:invalid_request_error rec:authentication_error rec:rate_limit_error rec:api_error rec:timeout_error ) ; sh:minCount 1 ] ;
  sh:property [ sh:path rec:errorMessage ; sh:datatype xsd:string ; sh:minCount 1 ] ;
  sh:property [ sh:path rec:errorCode ; sh:datatype xsd:string ] .

### KGC receipt shape
rec:ReceiptShape a sh:NodeShape ;
  sh:targetClass rec:Receipt ;
  sh:property [ sh:path rec:receiptChain ; sh:datatype xsd:string ; sh:minCount 1 ] .
